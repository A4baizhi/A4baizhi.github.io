<!DOCTYPE html>
<html>
<head>
    <title>Model Prediction</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.7.0/dist/tf.min.js"></script>
</head>
<body>
    <h1>Model Prediction 0.0.8</h1>
    <form id="prediction-form">
        <label for="feature1">土层深度(cm):</label>
        <input type="text" name="feature1" id="feature1" required><br>
        <label for="feature2">地膜覆盖年限:</label>
        <input type="text" name="feature2" id="feature2" required><br>
        <label for="feature3">平均风速:</label>
        <input type="text" name="feature3" id="feature3" required><br>
        <label for="feature4">年均温度:</label>
        <input type="text" name="feature4" id="feature4" required><br>
        <label for="feature5">日照时数:</label>
        <input type="text" name="feature5" id="feature5" required><br>
        <label for="feature6">相对湿度:</label>
        <input type="text" name="feature6" id="feature6" required><br>
        <label for="feature7">平均气压:</label>
        <input type="text" name="feature7" id="feature7" required><br>
        <label for="feature8">降水量:</label>
        <input type="text" name="feature8" id="feature8" required><br>
        <label for="feature9">平均地温:</label>
        <input type="text" name="feature9" id="feature9" required><br>
        <label for="feature10">年蒸发量:</label>
        <input type="text" name="feature10" id="feature10" required><br>
        <label for="feature11">沙质占比:</label>
        <input type="text" name="feature11" id="feature11" required><br>
        <label for="feature12">黏土占比:</label>
        <input type="text" name="feature12" id="feature12" required><br>
        <label for="feature13">淤泥占比:</label>
        <input type="text" name="feature13" id="feature13" required><br>
        <label for="feature14">作物编码:</label>
        <input type="text" name="feature14" id="feature14" required><br>
        <button type="submit">Predict</button>
        
        <p id="result"></p>
    </form>


    <script>
        // 加载模型
        async function loadModel() {
            const model = await tf.loadLayersModel('model.json');
            return model;
        }

        // 处理表单提交事件
        async function handleSubmit(event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const feature1 = Number(formData.get('feature1'));
            const feature2 = Number(formData.get('feature2'));
            const feature3 = Number(formData.get('feature3'));
            const feature4 = Number(formData.get('feature4'));
            const feature5 = Number(formData.get('feature5'));
            const feature6 = Number(formData.get('feature6'));
            const feature7 = Number(formData.get('feature7'));
            const feature8 = Number(formData.get('feature8'));
            const feature9 = Number(formData.get('feature9'));
            const feature10 = Number(formData.get('feature10'));
            const feature11 = Number(formData.get('feature11'));
            const feature12 = Number(formData.get('feature12'));
            const feature13 = Number(formData.get('feature13'));
            const feature14 = Number(formData.get('feature14'));
            
            // 加载模型
            const model = await loadModel();
            
            // 加载标准化参数（均值和标准差）
            const scalerParams = await fetch('scaler_params.json').then(response => response.json());
            const { mean, std } = scalerParams;

            // 定义标准化函数
            function standardizeFeatures(features) {
                return features.map((feature, index) => (feature - mean[index]) / std[index]);
            }
                        
            // 对输入进行预处理
            const inputFeatures = [feature1, feature2, feature3, feature4, feature5, feature6, feature7, feature8, feature9, feature10, feature11, feature12, feature13, feature14];
            
            // 对输入特征进行标准化
            const standardizedFeatures = standardizeFeatures(inputFeatures);

            // 创建输入张量
            const input = tf.tensor([standardizedFeatures]);
            
            // 进行预测
            const prediction = model.predict(input);
            
            // 显示结果
            const resultElement = document.getElementById('result');
            resultElement.innerText = `预测结果: ${prediction.dataSync()[0]}`;
            
            // 打印预测结果
            prediction.print();
        }

        // 绑定表单提交事件处理程序
        const form = document.getElementById('prediction-form');
        form.addEventListener('submit', handleSubmit);
    </script>
</body>
</html>
